# No existing discworld session? Then create one
if [[ ! $(tmux ls -F '#S') =~ discworld ]]; then

    # Zero out log files to keep size down
    #rm logs/minimap.log && touch logs/minimap.log
    #rm logs/mapdoortext.log && touch logs/mapdoortext.log
    #rm logs/chat.log && touch logs/chat.log

    # Start a new tmux session named "discworld"
    tmux new-session -d -A -D -s discworld
fi

    # Create the top pane with 6 lines
    tmux split-window -t discworld:0.0 -v -b -l 6
    sleep 0.1
    tmux display-message "Created top pane with 6 lines"
    # Panes: 0 (top), 1 (bottom)
    tmux select-pane -t discworld:0.1
    sleep 0.1
    tmux display-message "Selected bottom pane"

    # Create the right column with two panes, each about 30 chars wide
    tmux split-window -t discworld:0.1 -h -l 30
    sleep 0.1
    tmux display-message "Created right column with two panes"
    # Panes: 1 (left), 2 (right)
    tmux select-pane -t discworld:0.2
    sleep 0.1
    tmux display-message "Selected right pane"

    tmux split-window -v -b -l 50
    sleep 0.1
    tmux display-message "Created bottom right pane"
    # Panes: 1 (left), 2 (top right), 3 (bottom right)

    # Create the left column with three panes
    tmux select-pane -t discworld:0.1
    sleep 0.1
    tmux display-message "Selected left pane"
    tmux split-window -v -l 9
    sleep 0.1
    tmux display-message "Created middle left pane"
    # Panes: 1 (top left), 4 (middle left), 2 (top right), 3 (bottom right)
    tmux split-window -v -l 2
    sleep 0.1
    tmux display-message "Created bottom left pane"
    # Panes: 1 (top left), 4 (middle left), 5 (bottom left), 2 (top right), 3 (bottom right)

    # Select the bottom pane for control
    tmux select-pane -t discworld:0.3
    sleep 0.1
    tmux display-message "Selected bottom pane for control"

    #   0     
    #--------
    # 1 | 4
    #---|
    # 2 |----
    # --| 5
    # 3 |
    #--------
    tmux send-keys -t discworld:0.0 'clear && tail -fs .5 logs/chat.log' 'C-m'
    sleep 0.1
    tmux display-message "Sent keys to top pane"
    tmux send-keys -t discworld:0.4 './bin/grp' 'C-m'
    sleep 0.1
    tmux display-message "Sent keys to middle left pane"
    tmux send-keys -t discworld:0.5 './bin/map' 'C-m'
    sleep 0.1
    tmux display-message "Sent keys to bottom left pane"
    tmux send-keys -t discworld:0.1 './bin/dt' 'C-m'
    sleep 0.1
    tmux display-message "Sent keys to top left pane"
    tmux send-keys -t discworld:0.2 './bin/mdt' 'C-m'
    sleep 0.1
    tmux display-message "Sent keys to top right pane"
    tmux send-keys 'clear && tt++ -G config.tin' 'C-m'
    tmux display-message "Sent keys to current pane"

if [ -z "$TMUX" ]; then
    tmux -2 attach-session -t discworld -d
fi